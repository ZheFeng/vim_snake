$(document).ready(function(){function c(){s="right";u=0;l=100;h();p();f=false;if(typeof game_loop!="undefined")clearInterval(game_loop);game_loop=setInterval(d,l)}function h(){var e=5;a=[];for(var t=e-1;t>=0;t--){a.push({x:t,y:10})}}function p(){o={x:Math.round(Math.random()*(n-i)/i),y:Math.round(Math.random()*(r-i)/i)}}function d(){$("#score").html(u);$("#speed").html(l);t.fillStyle="black";t.fillRect(0,0,n,r);t.strokeStyle="#00CC00";t.strokeRect(0,0,n,r);var e=a[0].x;var i=a[0].y;if(s=="right")e++;else if(s=="left")e--;else if(s=="up")i--;else if(s=="down")i++;if(m(e,i,a)){g(u);c();return}if(e==o.x&&i==o.y&&f){var h={x:e,y:i};u+=125;l-=3;if(typeof game_loop!="undefined")clearInterval(game_loop);game_loop=setInterval(d,l);p()}else{var h=a.pop();h={x:e,y:i}}a.unshift(h);for(var y=0;y<a.length;y++){var b=a[y];v(b.x,b.y,"#00CC00")}v(o.x,o.y,"#f1c40f");if(f){t.font="12pt monospace";t.fillStyle="#00CC00";t.fillText("--INSERT--",5,r-5)}}function v(e,n,r){r=r||"#e74c3c";t.fillStyle=r;t.fillRect(e*i,n*i,i,i);t.strokeStyle=r;t.strokeRect(e*i,n*i,i,i)}function m(e,t,s){if(e<=-1||e>=n/i||t<=-1||t>=r/i){return true}else{for(var o=0;o<s.length;o++){if(e==s[o].x&&t==s[o].y){return true}}return false}}function g(e){var t=parseInt($("#topscore").html());if(e>t){$.ajax({url:"/newtop",type:"POST",data:{score:e},success:function(){alert("New High Score!");$("#topscore").html(e)},error:function(){alert("Fail")}})}}var e=$("#canvas")[0];var t=e.getContext("2d");var n=$("#canvas").width();var r=$("#canvas").height();var i=10;var s;var o;var u=0;var a;var f;var l;c();$(document).keydown(function(e){var t=e.which;if(f){if(t=="27")f=false}else{if(t=="72"&&s!="right")s="left";else if(t=="74"&&s!="up")s="down";else if(t=="76"&&s!="left")s="right";else if(t=="75"&&s!="down")s="up";else if(t=="73")f=true;else if(t=="27")f=false}})})
